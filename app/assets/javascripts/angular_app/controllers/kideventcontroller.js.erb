(function() {
  var app = angular.module('kid-events', []);

  app.controller('KidEventController', [ '$http', '$scope', '$rootScope', function($http, $scope, $rootScope){
    $scope.events = [];
    $scope.event  = {};

    $scope.index = function() {
      $http.get('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events?auth_token=' + $rootScope.current_user.authentication_token)
        .success(function(data) {
          $scope.events = data;
        });
    };

    $rootScope.getevents = $scope.index;

    $scope.create = function(form) {
      console.log($scope.event);
      $http.post('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events?auth_token=' + $rootScope.current_user.authentication_token, $scope.event)
        .success(function(data) {
          form.setForm(0);
          $scope.events.push(data);
          $scope.event = {};
        });
    };

    $scope.duplicate = function(event) {
      $http.post('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events?auth_token=' + $rootScope.current_user.authentication_token, event)
        .success(function(data) {
          $scope.events.push(data);
          data.datetime = new Date();
        });
    }

    $scope.edit = function(event) {
      $http.patch('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events/' + event.id + '?auth_token=' + $rootScope.current_user.authentication_token, event)
        .success(function(data) {
        });
    };

    $scope.delete = function(event) {
      console.log(event);
      $http.delete('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events/' + event.id + '?auth_token=' + $rootScope.current_user.authentication_token)
        .success(function(data) {
          if(confirm('Are you sure you want to delete this event?')) {
            var index = $scope.events.map(function(e) { return e.id; }).indexOf(event.id);
            $scope.events.splice(index, 1);
          };
        });
    };

  }]);

  app.controller('DropdownCtrl', function ($scope) {
    $scope.status = {
      isopen: false
    };

    $scope.toggleDropdown = function($event) {
      $event.preventDefault();
      $event.stopPropagation();
      $scope.status.isopen = !$scope.status.isopen;
    };

  });

  app.controller('DatepickerCtrl', function ($scope) {
    $scope.open = function($event) {
      $event.preventDefault();
      $event.stopPropagation();

      $scope.opened = true;
    };

  });

  app.controller('TimepickerCtrl', function ($scope, $log) {
    $scope.mytime = new Date();
  });

})();
