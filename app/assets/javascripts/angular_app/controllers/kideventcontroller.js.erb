(function() {
  var app = angular.module('kid-events', []);

  app.controller('KidEventController', [ '$http', '$scope', function($http, $scope){
    $scope.events = [];
    $scope.event  = {};

    // TODO: for testing purposes only
    $scope.auth_token = 'R_x23UQx-tW2BtCNwcxm';

    $scope.index = function() {
      console.log($scope.kidlist)
      $http.get('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events?auth_token=' + $scope.auth_token)
        .success(function(data) {
          $scope.events = data;
        });
    };

    $scope.getevents = this.index;

    $scope.create = function() {
      $http.post('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events?auth_token=' + $scope.auth_token, $scope.event)
        .success(function(data) {
          $scope.events.push(data);
          $scope.event = {};
        });
    };

    $scope.edit = function(event) {
      $http.patch('/api/v1/kids/' + $scope.kidlist.current_kid.id + '/events/' + event.id + '?auth_token=' + $scope.auth_token, event)
        .success(function(data) {
        });
    };

    $scope.delete = function(product) {
      $http.delete('/api/v1/kids' + $scope.kidlist.current_kid.id + '/events/' + event.id + '?auth_token=' + $scope.auth_token)
        .success(function(data) {
          if(confirm('Are you sure you want to delete this event?')) {
            var index = $scope.events.map(function(e) { return e.id; }).indexOf(event.id);
            $scope.events.splice(index, 1);
          };
        });
    }

  }]);

  app.controller('DropdownCtrl', function ($scope) {

    $scope.toggleDropdown = function($event) {
      $event.preventDefault();
      $event.stopPropagation();
      $scope.status.isopen = !$scope.status.isopen;
    };

  });

  app.controller('DatepickerDemoCtrl', function ($scope) {

    $scope.open = function($event) {
      $event.preventDefault();
      $event.stopPropagation();

      $scope.opened = true;
    };

  });
})();
