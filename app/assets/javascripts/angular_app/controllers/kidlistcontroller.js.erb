(function(){
  var app = angular.module('kid-list', []);

  app.controller('KidListController', [ '$http', '$rootScope', function($http, $rootScope){
    kidlist = this;
    kidlist.kids = [];

    kidlist.current_kid = null;
    kidlist.new_kid = {};

    kidlist.show_form = false;

    kidlist.index = function(){
      $http.get('/api/v1/kids?auth_token=' + $rootScope.current_user.authentication_token)
        .success(function(data){
          kidlist.kids = data.reverse();
        });
    };
    // put kidlist index function into the global scope so it can be called after a session is created
    $rootScope.getKidList = kidlist.index;

    kidlist.create = function(){
      $http.post('/api/v1/kids?auth_token=' + $rootScope.current_user.authentication_token, kidlist.new_kid)
        .success(function(data){
          kidlist.kids.push(data);
          kidlist.show_form = false;
        });
    };

    kidlist.setKid = function(kid){
      kidlist.current_kid = kid;
      $rootScope.getevents();
    };
  }]);
})();
